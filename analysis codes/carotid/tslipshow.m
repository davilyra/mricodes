%% read the MAP data for reconstruction
clear all; close all; clc
rawdata = rawdataRead('Run2730.6904.02.raw.bin', 33, 131, 131, 128, 1, 15);

petbl = [24576,24576,4096,0,12288,1,12288,2,12288,3,12288,4,12288,5,12288,...
    6,12288,7,12288,8,12288,9,12288,10,12288,11,12288,12,12288,13,12288,...
    14,12288,15,12288,16,12288,17,12288,18,12288,19,12288,20,12288,21,...
    12288,22,12288,23,12288,24,12288,25,12288,26,12288,27,12288,28,12288,...
    29,12288,30,12288,31,12288,32,12288,33,12288,34,12288,35,12288,36,...
    12288,37,12288,38,12288,39,12288,40,12288,41,12288,42,12288,43,12288,...
    44,12288,45,12288,46,12288,47,12288,48,12288,49,12288,50,12288,51,...
    12288,52,12288,53,12288,54,12288,55,12288,56,12288,57,12288,58,12288,...
    59,12288,60,12288,61,12288,62,12288,63,12288];

b = find(petbl<100);
rd = rawdata(:,b,:,:);
rdd = rd(:,:,:,1);
rdd = squeeze(rdd);
xx = ifftn(rdd);

figure,imagesc(abs(squeeze(xx(10,:,:)))), title('image of channel 1 slice 1')
figure,imagesc(abs(squeeze(fftshift(xx(10,:,:))))), title('ifftshift image of channel 1 slice 1')
figure,imagesc(abs(squeeze(fftshift(xx((size(b,2)/2),:,:))))), title('ifftshift image of channel 1 slice 16')
figure,imagesc(abs(squeeze(rdd((size(b,2)/2),:,:)))), title('raw data of center SE encoding--look right')
figure,imagesc(abs(squeeze(rdd(1,:,:)))), title('raw data of edge SE encoding--look strange')
